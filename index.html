<!DOCTYPE html>
<html>
    <body>
        <h1>Canvas Example</h1>
        <canvas id="canvas" class="border" width="600" height="600">
        </canvas>
        <div>
            <label>name:</label>
            <input id="name"  type="text">
        </div> 

        <div>
            <label>desc:</label>
            <input id="desc" type="textarea">
        </div>

        <button id="mybutton" type="=button" onclick="onClick();">
            HTML
        </button>
        
        <script>
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            const button = document.querySelector('#mybutton');

            const rect = canvas.getBoundingClientRect();
            let clickedBoxIndex = -1;

            const persons = [
                {
                    name: "은진",
                    desc: "디발자가 되고 싶은 30대를 앞두고 있습니다."
                },
                {
                    name: "한울",
                    desc: "휴우.... 디발자 가르치기 참 힘들군요...",
                },
                {
                    name: "구절",
                    desc: "못생긴 구절"
                }
            ]

            const gap = 10;
            const boxWidth = 600;
            const boxHeight = 50;
            let isMoving = false;
            let xInClickedArea = 0;
            let yInClickedArea = 0;

            window.addEventListener('load', () => {
        
            });
            window.addEventListener('load', drawPersonList);

            let x = 0;
            let y = 0;

            canvas.addEventListener('mousedown', e => {
                x = e.clientX;
                y = e.clientY;
                console.log(`{${x}, ${y}}`);
                console.log(`Screen: {${e.screenX}, ${e.screenY}}`);
                console.log(`Offet: {${e.offsetX}, ${e.offsetY}}`);
                clickedBoxIndex = Math.floor(e.offsetY / (boxHeight + gap));

                if (clickedBoxIndex > (persons.length - 1)) {
                    clickedBoxIndex = -1;
                    isMoving = false;
                    return;
                } 

                isMoving = true;
                xInClickedArea = e.offsetX;
                yInClickedArea = e.offsetY - (clickedBoxIndex * (boxHeight + gap));
                ctx.clearRect(0, 0, 600, 600);
                drawPersonList();
                console.log(clickedBoxIndex);
            })

            function clearCanvas() {
                ctx.clearRect(0, 0, 600, 600);
            }

            canvas.addEventListener('mousemove', e => {
                if (clickedBoxIndex !== -1 && isMoving === true) {
                    clearCanvas();
                    drawPersonList();
                    const personSelected = persons[clickedBoxIndex]
                    const currentY = e.offsetY - yInClickedArea;
                    const currentX = e.offsetX - xInClickedArea;

                    ctx.strokeStyle = "rgb(255, 165, 0)";
                    ctx.strokeRect(currentX, currentY, boxWidth, boxHeight);
                    ctx.fillText(personSelected.name, currentX + 20, currentY + 20);
                    ctx.fillText(personSelected.desc, currentX + 20, currentY + 30);
                }
            })

            canvas.addEventListener('mouseup', e => {
                if (isMoving === true) {
                    clearCanvas();
                    drawPersonList();
                    const personSelected = persons[clickedBoxIndex]
                    const currentY = e.offsetY - yInClickedArea;
                    const currentX = e.offsetX - xInClickedArea;
                    
                    ctx.strokeStyle = "rgb(0, 0, 0)";
                    ctx.strokeRect(currentX, currentY, boxWidth, boxHeight);
                    ctx.fillText(personSelected.name, currentX + 20, currentY + 20);
                    ctx.fillText(personSelected.desc, currentX + 20, currentY + 30);
                }
                isMoving = false;
            })

            function drawPersonList () {
                for(i = 0; i < persons.length; i++) {
                    drawPersonAt(i, persons[i]);
                }
            }

            function getPerson () {
                const nameElement = document.getElementById("name");
                const descElement = document.getElementById("desc");
                
                return {
                    name: nameElement.value,
                    desc: descElement.value
                }
            }

            function drawPersonAt (position, persons) {
                const currentY = position * (boxHeight + gap);
                if (position === clickedBoxIndex) {
                    ctx.strokeStyle = "rgb(255, 165, 0)";
                } else {
                    ctx.strokeStyle = "rgb(0, 0, 0)";
                }
                

                ctx.strokeRect(0, currentY, boxWidth, boxHeight);
                ctx.fillText(persons.name, 20, currentY + 20);
                ctx.fillText(persons.desc, 20, currentY + 30);
            }

            function onClick () {
                const person = getPerson ();
                drawPersonAt(persons.length, person);
                persons.push(person);
            }

        </script>
        <style>
            .border {
                border: 1px solid red;
            }
        </style>
    </body>
</html>